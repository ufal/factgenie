<!DOCTYPE html>
<html>

<head>
  <title>factgenie</title>
  <link rel="stylesheet" media="screen" href="{{ host_prefix }}/static/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="{{ host_prefix }}/static/css/custom.css">
  <link href="{{ host_prefix }}/static/css/font-awesome.css" rel="stylesheet">
  <link rel="shortcut icon" href="{{ host_prefix }}/static/img/favicon.ico">
  <meta name="viewport" content="width=1024">
  <script src="{{ host_prefix }}/static/js/jquery.min.js"></script>
  <script src="{{ host_prefix }}/static/js/popper.min.js"></script>
  <script src="{{ host_prefix }}/static/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
  <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
</head>

{% include 'navbar.html' %}


<div class="container w-50  mt-5">
  <a href="{{ host_prefix }}/crowdsourcing" class="btn btn-outline-secondary mb-5">‚Üê Crowdsourcing campaigns</a>
  <div class="mt-1">

    <form id="annotation-campaign-form">
      <h3>New crowdsourcing campaign</h3>

      <ul class="nav nav-tabs nav-justified mt-5">
        <li class="nav-item">
          <a class="nav-link active" id="nav-tabs-campaign" aria-current="page" href="#tab-campaign"
            data-bs-toggle="pill">Campaign</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="nav-tabs-config" href="#tab-config" data-bs-toggle="pill">Configuration</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="nav-tabs-data" href="#tab-data" data-bs-toggle="pill">Data</a>
        </li>
      </ul>

      <div class="tab-content">
        <div id="tab-campaign" role="tabpanel" class="tab-pane active new-campaign-form" tabindex="0">
          <div class="row g-3 mb-3 align-items-center">
            <div class="col-auto">
              <label for="campaignId">Campaign Id</label>
            </div>
            <div class="col-auto">
              <input type="text" class="form-control" id="campaignId" name="campaignId"
                value="{{ default_campaign_id }}" required>
            </div>
            <div class="col-auto">
              <i class="fa fa-question-circle opacity-25" aria-hidden="true" data-bs-toggle="tooltip"
                title="Create a unique campaign identifier"></i>
            </div>
          </div>
          <div style="text-align: center;">
            <button type="button" class="btn btn-primary mt-3"
              onclick='bootstrap.Tab.getOrCreateInstance($("#nav-tabs-config")).show()'>Next</button>
          </div>
        </div>
        <div id="tab-config" role="tabpanel" class="tab-pane new-campaign-form" tabindex="1">
          <div class="row g-3 mb-3 align-items-center">
            <div class="col-auto">
              <span style="margin-left: 5px; margin-right: 10px;">Preset</span>
            </div>
            <div class="col-auto">
              <select class="form-select" id="crowdsourcingConfig" name="crowdsourcingConfig"
                onchange="updateCrowdsourcingConfig();">
                <option value="[None]">[None]</option>
                {% for config_name in configs.keys() %}
                <option value="{{ config_name }}">{{ config_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-auto">
              <i class="fa fa-question-circle opacity-25" aria-hidden="true" data-bs-toggle="tooltip" title="Add your custom preset to
          factgenie/config/crowdsourcing or save your current configuration."></i>
            </div>
          </div>

          <div class="rounded-box mt-4">
            <!-- textarea for annotator instructions -->
            <div class="form-group">
              <label for="annotatorInstructions">Annotator instructions</label>
              <div class="mb-2">
                <small class="form-text text-muted">Instructions shown to the annotators. Use Markdown syntax.</small>
              </div>
              <textarea class="form-control" id="annotatorInstructions" name="annotatorInstructions"
                required></textarea>
            </div>
            <!-- checkbox for displaying overlay -->
            <div class="form-group">
              <label for="displayOverlay">Show overlay</label>
              <div class="mb-2">
                <small class="form-text text-muted">Display an introductory overlay with the instructions.</small>
              </div>
              <div class="form-check form-switch">
                <input type="checkbox" class="form-check-input" id="displayOverlay" name="displayOverlay" checked>
              </div>
            </div>
            <!-- textarea for annotator prompt -->
            <div class="form-group mt-3">
              <label for="annotatorPrompt">Annotator prompt</label>
              <div class="mb-2">
                <small class="form-text text-muted">The message shown right before the annotated text.</small>
              </div>
              <textarea class="form-control" id="annotatorPrompt" name="annotatorPrompt" rows="1" required></textarea>
            </div>
            <!-- textarea for final message -->
            <div class="form-group  mt-4">
              <label for="finalMessage">Final message</label>
              <div class="mb-2">
                <small class="form-text text-muted">The message shown after the annotator has submitted the annotations.
                  Use Markdown syntax. You should include the completion code here. </small>
              </div>
              <textarea class="form-control" id="finalMessage" name="finalMessage" required></textarea>
            </div>
            <div class="form-group">
              <label for="examplesPerBatch">Examples per batch</label>
              <div class="mb-2">
                <small class="form-text text-muted">Number of examples shown to each annotator </small>
              </div>
              <input type="number" class="form-control" id="examplesPerBatch" name="examplesPerBatch" min="1" required>
            </div>
            <div class="form-group mt-4">
              <!-- select for sort order -->
              <label for="sortOrder">Shuffle outputs</label>
              <div class="mb-2">
                <small class="form-text text-muted">How to shuffle examples before batching (model outputs are
                  shuffled always).</small>
              </div>
              <select class="form-select" id="sortOrder" name="sortOrder">
                <option value="dataset-level">Shuffle the examples</option>
                <option value="example-level">Keep the order of examples</option>
              </select>
            </div>
            <div class="form-group mt-4">
              <label for="idleTime">Idle Time (minutes)</label>
              <div class="mb-2">
                <small class="form-text text-muted">The time after which an unfinished example can be re-assigned to a
                  new annotator.
                </small>
              </div>
              <input type="number" class="form-control" id="idleTime" name="idleTime" min="0">
            </div>

            {% include 'forms/annotation_span_categories.html' %}
          </div>

          <div style="text-align: center;">
            <button type="button" class="btn btn-outline-secondary mt-3"
              onclick='bootstrap.Tab.getOrCreateInstance($("#nav-tabs-campaign")).show()'>Back</button>
            <button type="button" class="btn btn-outline-secondary mt-3" data-bs-toggle="modal"
              data-bs-target="#save-cfg-modal">Save config as...</button>
            <button type="button" class="btn btn-primary mt-3"
              onclick=' bootstrap.Tab.getOrCreateInstance($("#nav-tabs-data")).show()'>Next</button>
          </div>
        </div>

        <div id="tab-data" class="tab-pane new-campaign-form" role="tabpanel" tabindex="2">

          {% include 'forms/data_selection.html' %}

          <div style="text-align: center;">
            <button type="button" class="btn btn-outline-secondary mt-3"
              onclick='bootstrap.Tab.getOrCreateInstance($("#nav-tabs-config")).show()'>Back</button>
            <button type="button" class="btn btn-primary mt-3" onclick="createHumanCampaign();">Create campaign</button>
          </div>
        </div>
      </div>
    </form>
    <div>

    </div>
  </div>


  <div class="modal fade" id="save-cfg-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="about-modal-label">Save config as...</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id='configarea' class="tab-pane sidepanel-panel w-75" role="tabpanel" tabindex="0">
            <label for="exampleDataList" class="form-label">Config name</label>
            <div class="input-group mb-3">
              <input type="text" class="form-control" id="config-save-filename" list="datalistOptions"
                placeholder="Click to see existing configurations..."
                aria-label="Click to see existing configurations..." aria-describedby="basic-addon2">
              <span class="input-group-text" id="basic-addon2">.yaml</span>
            </div>
            <datalist id="datalistOptions">
              {% for config_filename in configs.keys() %}
              <!-- save the name without suffix to variable -->
              {% set config_name = config_filename.rstrip(".yaml") %}
              <option value="{{ config_name }}">{{ config_filename }}</option>
              {% endfor %}
            </datalist>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" id="save-cfg-submit" class="btn btn-primary mt-3"
            onclick="saveConfig('crowdsourcing')">Save
            config</button>
        </div>
      </div>
    </div>

  </div>

</div>


<script>
  // variable to be used in factgenie.js
  window.url_prefix = "{{ host_prefix }}";
  window.model_outs = {{ model_outs | tojson | safe }};
  window.configs = {{ configs | tojson | safe }};
  window.mode = "crowdsourcing";

  var annotatorInstructionsMDE = new SimpleMDE({
    element: $("#annotatorInstructions")[0], spellChecker: false,
    // autosave: { enabled: true, unique_id: "annotatorInstructionsText" } 
  });
  var finalMessageMDE = new SimpleMDE({
    element: $("#finalMessage")[0], spellChecker: false,
    // autosave: { enabled: true, unique_id: "finalMessageText" } 
  });
</script>
<script src="{{ host_prefix }}/static/js/factgenie.js"></script>